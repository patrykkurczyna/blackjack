package pl.edu.agh.sr.server.impl;

import java.rmi.RemoteException;
import java.util.HashMap;

import pl.edu.agh.sr.api.Blackjack;
import pl.edu.agh.sr.api.BlackjackException;
import pl.edu.agh.sr.api.BlackjackListener;
import pl.edu.agh.sr.api.UserToken;

public class BlackjackImpl implements Blackjack{

	private static Deck deck;
	private static Integer counter = 1;
	private HashMap<UserToken, BlackjackListener> registeredClients;
	
	public BlackjackImpl() {
		registeredClients = new HashMap<UserToken, BlackjackListener>();
		this.deck = new Deck();
	}
	
	public void makeChoice(UserToken userToken, boolean choice)
			throws RemoteException, BlackjackException {
		String choiceString = (choice == true ? "YES" : "NO");
		if (!registeredClients.containsKey(userToken)) {
			throw new BlackjackException();
		} else {
			
			
			
			for (Map.Entry<UserToken, BlackjackListener> registeredClient : registeredClients.entrySet()) {
				registeredClient.getValue().onNewText(text);
			}
		}			
	}

	public UserToken enterGame(String nick, BlackjackListener listener)
			throws RemoteException, BlackjackException {
		UserToken token = new UserTokenImpl(nick, counter);
		counter++;
		if (registeredClients.containsKey(token)) {
			throw new BlackjackException();
		} else {
			registeredClients.put(token, listener);
			System.out.println("New client registered: " + token);
		}
		return token;
	}

	public void exitGame(UserToken token) throws RemoteException,
			BlackjackException {
		if (!registeredClients.containsKey(token)) {
			throw new BlackjackException();
		} else {
			registeredClients.remove(token);
		}		
	}
	
}
